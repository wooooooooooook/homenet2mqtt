meta:
  name: "난방 설정"
  name_en: "Heaters"
  description: "코콤 난방 온도조절기 설정입니다. 난방 개수를 설정할 수 있습니다."
  description_en: "Kocom heating thermostats configuration. You can configure the number of thermostats."
  version: "2.0.1"
  author: "wooooooooooook"
  tags: ["climate", "heater", "thermostat", "kocom"]

parameters:
  - name: heater_count
    type: integer
    default: 4
    min: 1
    max: 8
    label: "난방 개수"
    label_en: "Number of Heaters"

discovery:
  match:
    data: [0x30, 0xd0, 0x00, 0x36]
    mask: [0xFF, 0xFF, 0xFF, 0xFF]

entities:
  climate:
    - $repeat:
        count: '{{heater_count}}'
        as: i
        start: 1
      id: 'room_{{i - 1}}_heater'
      name: 'Room {{i - 1}} Heater'
      visual:
        min_temperature: 5 °C
        max_temperature: 30 °C
        temperature_step: 1 °C
      state:
        data: [0x30, 0xd0, 0x00, 0x36, '{{i - 1}}']
        mask: [0xff, 0xf0, 0xff, 0xff, 0xff]
      state_temperature_current:
        offset: 12
        length: 1
        precision: 0
      state_temperature_target:
        offset: 10
        length: 1
        precision: 0
      state_off:
        offset: 8
        data: [0x00]
        mask: [0xF0]
      state_heat:
        offset: 8
        data: [0x10]
        mask: [0xF0]
        
      # Kocom 일반 Cmd: [[0x30, 0xbc, 0x00, 0x36, index, 0x01, 0x00, 0x00, mode, 0x00, target, ...], [Ack]]
      # mode: off=0x01, heat=0x11 ?
      # heater_new logic: cmd_off -> mode 0x01. cmd_heat -> mode 0x11.
      command_off: >-
        [[0x30, 0xbc, 0x00, 0x36, '{{i - 1}}', 0x01, 0x00, 0x00, 0x01, 0x00, int(x), 0x00, 0x00, 0x00, 0x00, 0x00], [0x30, 0xdc]]
      command_heat: >-
        [[0x30, 0xbc, 0x00, 0x36, '{{i - 1}}', 0x01, 0x00, 0x00, 0x11, 0x00, int(x), 0x00, 0x00, 0x00, 0x00, 0x00], [0x30, 0xdc]]
      command_temperature: >-
        [[0x30, 0xbc, 0x00, 0x36, '{{i - 1}}', 0x01, 0x00, 0x00, 0x11, 0x00, int(x), 0x00, 0x00, 0x00, 0x00, 0x00], [0x30, 0xdc]]
