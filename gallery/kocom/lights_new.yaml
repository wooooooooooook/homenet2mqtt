meta:
  name: "☑️조명 설정"
  name_en: "☑️Lights"
  description: "코콤 조명 설정입니다. 방 개수를 설정할 수 있으며, 방당 2개 조명이 생성됩니다."
  description_en: "Kocom lights configuration. Configure room count, with 2 lights per room."
  version: "2.0.0"
  author: "wooooooooooook"
  tags: ["light", "kocom"]

parameters:
  - name: rooms
    type: integer[]
    label: "방 번호 목록"
    label_en: "Room ID List"
    default: [0, 1, 2, 3]
    schema:
      min: 0
      max: 15

discovery:
  match:
    data: [0x30, 0xD0, 0x00, 0x0E]
    mask: [0xFF, 0xFF, 0xFF, 0xFF]
  dimensions:
    - parameter: "room_idx"
      offset: 4
  inference:
    strategy: "count"
    output: "rooms"
  ui:
    label: "조명"
    label_en: "lights"
    summary: "{room_count}개 방 발견됨"
    summary_en: "{room_count} rooms discovered"

entities:
  light:
    - $repeat:
        over: rooms
        as: room_idx
      $nested:
        # Light 1 (offset 8)
        - id: 'room_{{room_idx}}_light_1'
          name: 'Room {{room_idx}} Light 1'
          state:
            data: [0x30, 0xD0, 0x00, 0x0E, '{{room_idx}}']
            mask: [0xFF, 0xF0, 0xFF, 0xFF, 0xFF]
          state_on:
            offset: 8
            data: [0xFF]
          state_off:
            offset: 8
            data: [0x00]
          command_on: >-
            [[0x30, 0xBC, 0x00, 0x0E, {{room_idx}}, 0x01, 0x00, 0x00, 0xFF, states['room_{{room_idx}}_light_2']['state'] == 'ON' ? 0xFF : 0x00, 0, 0, 0, 0, 0, 0], [0x30, 0xDC]]
          command_off: >-
            [[0x30, 0xBC, 0x00, 0x0E, {{room_idx}}, 0x01, 0x00, 0x00, 0x00, states['room_{{room_idx}}_light_2']['state'] == 'ON' ? 0xFF : 0x00, 0, 0, 0, 0, 0, 0], [0x30, 0xDC]]

        # Light 2 (offset 9)
        - id: 'room_{{room_idx}}_light_2'
          name: 'Room {{room_idx}} Light 2'
          state:
            data: [0x30, 0xD0, 0x00, 0x0E, '{{room_idx}}']
            mask: [0xFF, 0xF0, 0xFF, 0xFF, 0xFF]
          state_on:
            offset: 9
            data: [0xFF]
          state_off:
            offset: 9
            data: [0x00]
          command_on: >-
            [[0x30, 0xBC, 0x00, 0x0E, {{room_idx}}, 0x01, 0x00, 0x00, states['room_{{room_idx}}_light_1']['state'] == 'ON' ? 0xFF : 0x00, 0xFF, 0, 0, 0, 0, 0, 0], [0x30, 0xDC]]
          command_off: >-
            [[0x30, 0xBC, 0x00, 0x0E, {{room_idx}}, 0x01, 0x00, 0x00, states['room_{{room_idx}}_light_1']['state'] == 'ON' ? 0xFF : 0x00, 0x00, 0, 0, 0, 0, 0, 0], [0x30, 0xDC]]
