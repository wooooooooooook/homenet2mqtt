meta:
  name: "환풍기"
  name_en: "Fan"
  description: "코콤 환풍기 설정입니다. (속도 조절 지원, 기본값: 거실)"
  description_en: "Kocom Fan configuration. Supports speed control. Default: Livingroom."
  version: "1.0.3"
  author: "wooooooooooook"
  tags: ["fan", "kocom"]

discovery:
  match:
    data: [0x30, 0xDC, 0x00, 0x48]
    mask: [0xFF, 0xF0, 0xFF, 0xFF]

entities:
  fan:
    - id: 'livingroom_fan'
      name: '거실 환풍기'
      icon: 'mdi:fan'
      state:
        data: [0x30, 0xDC, 0x00, 0x48, 0x00]
        mask: [0xFF, 0xF0, 0xFF, 0xFF, 0xFF]
      state_on:
        offset: 8
        data: [0x11]
        mask: [0xFF]
      state_off:
        offset: 8
        data: [0x00]
        mask: [0xFF]
      state_speed:
        offset: 10
        mask: 0xF0
        mapping:
          0x40: 33
          0x80: 66
          0xC0: 100
          0x00: 0
      command_on: >-
        [[0x30, 0xBC, 0x00, 0x48, 0x00, 0x01, 0x00, 0x00, 0x11, 0x00, 0x80, 0, 0, 0, 0, 0], [0x30, 0xDC], [0xFF, 0xF0]]
      command_off: >-
        [[0x30, 0xBC, 0x00, 0x48, 0x00, 0x01, 0x00, 0x00, 0x00, 0x01, 0x00, 0, 0, 0, 0, 0], [0x30, 0xDC], [0xFF, 0xF0]]
      command_speed: >-
        [[0x30, 0xBC, 0x00, 0x48, 0x00, 0x01, 0x00, 0x00,
        x == 0 ? 0x00 : 0x11,
        x == 0 ? 0x01 : 0x00,
        x == 0 ? 0x00 : (x <= 33 ? 0x40 : (x <= 66 ? 0x80 : 0xC0)),
        0, 0, 0, 0, 0], [0x30, 0xDC], [0xFF, 0xF0]]
