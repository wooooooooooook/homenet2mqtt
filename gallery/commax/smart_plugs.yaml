meta:
  name: "☑️스마트 콘센트 설정 (4개)"
  name_en: "☑️Smart Plugs (4 Outlets)"
  description: "코맥스 스마트 콘센트 4개 설정입니다. 전력 사용량 센서도 포함되어 있습니다."
  description_en: "Commax 4 smart plugs with power consumption sensors."
  version: "1.0.0"
  author: "wooooooooooook"
  tags: ["switch", "plug", "outlet", "power", "sensor", "commax"]

entities:
  #스마트 콘센트 (Plugs)
  #상태      Head,   PWR,  ID,   TYPE,  D1,   D2,   D3,   add checksum
  #TYPE 11 (Wattage), 21 (Eco - ignored)
  #PWR: 00(Off), 01(On), 10(Off+Auto), 11(On+Auto)
  #명령      Head,   ID,   CMD,  PWR,   00,   00,   00,   add checksum
  #명령 ON   0x7A,   ID,   01,   01,    00,   00,   00
  #명령 OFF  0x7A,   ID,   01,   00,    00,   00,   00

  switch:
    - id: 'plug_1'
      name: 'Plug 1'
      icon: 'mdi:power-socket-eu'
      state:
        data: [0xF9, 0x00, 0x01]
        mask: [0xFF, 0x00, 0xFF]
      state_on:
        offset: 1
        mask: [0x01]
        data: [0x01]
      state_off:
        offset: 1
        mask: [0x01]
        data: [0x00]
      command_on:
        data: [0x7A, 0x01, 0x01, 0x01, 0x00, 0x00, 0x00]
      command_off:
        data: [0x7A, 0x01, 0x01, 0x00, 0x00, 0x00, 0x00]

    - id: 'plug_2'
      name: 'Plug 2'
      icon: 'mdi:power-socket-eu'
      state:
        data: [0xF9, 0x00, 0x02]
        mask: [0xFF, 0x00, 0xFF]
      state_on:
        offset: 1
        mask: [0x01]
        data: [0x01]
      state_off:
        offset: 1
        mask: [0x01]
        data: [0x00]
      command_on:
        data: [0x7A, 0x02, 0x01, 0x01, 0x00, 0x00, 0x00]
      command_off:
        data: [0x7A, 0x02, 0x01, 0x00, 0x00, 0x00, 0x00]

    - id: 'plug_3'
      name: 'Plug 3'
      icon: 'mdi:power-socket-eu'
      state:
        data: [0xF9, 0x00, 0x03]
        mask: [0xFF, 0x00, 0xFF]
      state_on:
        offset: 1
        mask: [0x01]
        data: [0x01]
      state_off:
        offset: 1
        mask: [0x01]
        data: [0x00]
      command_on:
        data: [0x7A, 0x03, 0x01, 0x01, 0x00, 0x00, 0x00]
      command_off:
        data: [0x7A, 0x03, 0x01, 0x00, 0x00, 0x00, 0x00]

    - id: 'plug_4'
      name: 'Plug 4'
      icon: 'mdi:power-socket-eu'
      state:
        data: [0xF9, 0x00, 0x04]
        mask: [0xFF, 0x00, 0xFF]
      state_on:
        offset: 1
        mask: [0x01]
        data: [0x01]
      state_off:
        offset: 1
        mask: [0x01]
        data: [0x00]
      command_on:
        data: [0x7A, 0x04, 0x01, 0x01, 0x00, 0x00, 0x00]
      command_off:
        data: [0x7A, 0x04, 0x01, 0x00, 0x00, 0x00, 0x00]

  sensor:
    - id: 'plug_1_power'
      name: 'Plug 1 Power'
      device_class: power
      unit_of_measurement: W
      state:
        data: [0xF9, 0x00, 0x01, 0x11]
        mask: [0xFF, 0x00, 0xFF, 0xFF]
      state_number:
        offset: 4
        length: 3
        decode: bcd
        precision: 1

    - id: 'plug_2_power'
      name: 'Plug 2 Power'
      device_class: power
      unit_of_measurement: W
      state:
        data: [0xF9, 0x00, 0x02, 0x11]
        mask: [0xFF, 0x00, 0xFF, 0xFF]
      state_number:
        offset: 4
        length: 3
        decode: bcd
        precision: 1

    - id: 'plug_3_power'
      name: 'Plug 3 Power'
      device_class: power
      unit_of_measurement: W
      state:
        data: [0xF9, 0x00, 0x03, 0x11]
        mask: [0xFF, 0x00, 0xFF, 0xFF]
      state_number:
        offset: 4
        length: 3
        decode: bcd
        precision: 1

    - id: 'plug_4_power'
      name: 'Plug 4 Power'
      device_class: power
      unit_of_measurement: W
      state:
        data: [0xF9, 0x00, 0x04, 0x11]
        mask: [0xFF, 0x00, 0xFF, 0xFF]
      state_value: >-
        double((bcd_to_int(data[4]) * 10000) + (bcd_to_int(data[5]) * 100) + bcd_to_int(data[6])) * 0.1
