meta:
  name: "현대통신 엘리베이터"
  name_en: "Hyundai Telecom Elevator"
  description: "현대통신 월패드용 엘리베이터 호출 및 상태 확인 설정입니다."
  description_en: "Elevator call and status configuration for Hyundai Telecom wallpads."
  version: "1.0.1"
  author: "wooooooooooook"
  tags: ["elevator", "hyundai", "imazu"]

scripts:
  - id: 'elevator_call_down'
    actions:
      - action: send_packet
        data: [0xF7, 0x0B, 0x01, 0x34, 0x02, 0x41, 0x10, 0x06, 0x00, 0x9C, 0xEE]
        # 아래 패킷으로 된다는 분도 있습니다.
        # data: [0xF7, 0x0B, 0x01, 0x34, 0x04, 0x41, 0x10, 0x00, 0x06, 0x9A, 0xEE]
        checksum: false

  - id: 'elevator_call_up'
    actions:
      - action: send_packet
        # F7 0B 01 34 02 41 10 05 00 9F EE
        # Checksum 9F = XOR(F7..00)
        data: [0xF7, 0x0B, 0x01, 0x34, 0x02, 0x41, 0x10, 0x05, 0x00, 0x9F, 0xEE]
        checksum: false

entities:
  text_sensor:
    - id: 'elevator_floor'
      name: 'Elevator Floor'
      icon: 'mdi:elevator'
      state:
        # Match Query Packet: F7 0D 01 34 01 41 10 00 [State] [Floor] [ID] [CS] EE
        # Header(F7) is omitted in standard parsing usually, but index calculations assume F7 is x[0]
        data: [0x0D, 0x01, 0x34, 0x01, 0x41]
      state_value: >
        data[9] >= 0xB0 ? 'B' + string(data[9] - 0xB0) : string(data[9])

    - id: 'elevator_state'
      name: 'Elevator State'
      icon: 'mdi:elevator-passenger'
      state:
        data: [0x0D, 0x01, 0x34, 0x01, 0x41]
      state_value: >
        bitShiftRight(data[8], 4) == 0xA ? 'Up' : (bitShiftRight(data[8], 4) == 0xB ? 'Down' : 'Idle')

  button:
    - id: 'elevator_call_down'
      name: 'Call Elevator Down'
      icon: 'mdi:elevator-down'
      command_press:
        script: elevator_call_down
      discovery_linked_id: 'elevator_floor'

    - id: 'elevator_call_up'
      name: 'Call Elevator Up'
      icon: 'mdi:elevator-up'
      command_press:
        script: elevator_call_up
      discovery_linked_id: 'elevator_floor'
