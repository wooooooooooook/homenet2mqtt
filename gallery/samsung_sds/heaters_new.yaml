meta:
  name: "난방 설정"
  name_en: "Heaters"
  description: "삼성 SDS 난방 온도조절기 설정입니다. 개수를 지정할 수 있습니다. heating/idle 액션 상태 표시 지원."
  description_en: "Samsung SDS heating thermostats with configurable count. Supports heating/idle action status."
  version: "2.0.0"
  author: "wooooooooooook"
  tags: ["climate", "heater", "thermostat", "samsung", "sds"]

parameters:
  - name: heater_count
    type: integer
    default: 4
    min: 1
    max: 8
    label: "난방 개수"
    label_en: "Number of Heaters"

discovery:
  match:
    data: [0xB0, 0x7C]
    mask: [0xFF, 0xFF]
  dimensions:
    - parameter: "heater_count"
      offset: 2
  inference:
    strategy: max
  ui:
    label: "난방"
    label_en: "heaters"
    summary: "{{heater_count}}개 난방기 발견됨"
    summary_en: "{{heater_count}} heaters discovered"

entities:
  climate:
    - $repeat:
        count: '{{heater_count}}'
        as: i
        start: 1
      id: 'room_{{i - 1}}_heater'
      name: 'Room {{i - 1}} Heater'
      visual:
        min_temperature: 5 °C
        max_temperature: 40 °C
        temperature_step: 1 °C
      state:
        data: [0xB0, 0x7C, '{{i}}']
      state_temperature_current:
        offset: 5
        length: 1
      state_temperature_target:
        offset: 4
        length: 1
      state_off:
        offset: 3
        data: [0x00]
        mask: [0x01]
      state_heat:
        offset: 3
        data: [0x01]
        mask: [0x01]
      command_off:
        data: [0xAE, 0x7D, '{{i}}', 0x00, 0x00, 0x00, 0x00]
        ack: [0xB0, 0x7D, '{{i}}', 0x00]
      command_heat:
        data: [0xAE, 0x7D, '{{i}}', 0x01, 0x00, 0x00, 0x00]
        ack: [0xB0, 0x7D, '{{i}}', 0x01]
      command_temperature: >-
        [[0xAE, 0x7F, '{{i}}', x, 0x00, 0x00, 0x00],[0xB0, 0x7F, '{{i}}', x]]
      state_action: >-
        data[3] == 0x00 ? 'off' : (data[4] > data[5] ? 'heating' : 'idle')
